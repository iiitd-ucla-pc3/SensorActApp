<!DOCTYPE html> <!--[if lt IE 7]> <html class="no-js ie6 oldie" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js ie7 oldie" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js ie8 oldie" lang="en"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en">
	<!--<![endif]-->
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<title> Display </title>
		<link rel="shortcut icon" href="@{'/public/images/favicon.png'}" type="image/x-icon"> 
		<link rel="stylesheet" type="text/css" href="@{'/public/stylesheets/style.css'}">
		<link rel="stylesheet" type="text/css" href="@{'/public/stylesheets/jquery-ui-1.8.21.custom.css'}">
		<link rel="stylesheet" type="text/css" href="@{'/public/stylesheets/jquery-ui-timepicker-addon.css'}">
		
		<!--<link rel="stylesheet" type="text/css" href="@{'/public/stylesheets/styles_non_centered.css'}">-->
		<link rel="stylesheet" type="text/css" href="@{'/public/stylesheets/jquery.noty.css'}">
		<link rel="stylesheet" type="text/css" href="@{'/public/stylesheets/noty_theme_twitter.css'}">
		
		<script src="@{'/public/js/libs/modernizr-2.0.6.min.js'}"></script>
		<script src="@{'/public/javascripts/jquery-1.6.4.min.js'}" type="text/javascript" charset="${_response_encoding}"></script>
		<script src="@{'/public/javascripts/jquery.noty.js'}" type="text/javascript" charset="${_response_encoding}"></script>
		<script src="@{'/public/javascripts/jquery-ui-1.8.20.custom.min.js'}" type="text/javascript" charset="${_response_encoding}"></script>
		<script src="@{'/public/javascripts/highcharts.js'}" type="text/javascript" charset="${_response_encoding}"></script>
		<script src="@{'/public/javascripts/utilityFunctions.js'}" type="text/javascript" charset="${_response_encoding}"></script>
		<script src="@{'/public/javascripts/exporting.js'}" type="text/javascript" charset="${_response_encoding}"></script>
		<script src="@{'/public/javascripts/constants.js'}" type="text/javascript" charset="${_response_encoding}"></script>
		<script src="@{'/public/javascripts/jquery-ui-timepicker-addon.js'}" type="text/javascript" charset="${_response_encoding}"></script>
		
	
		
		<!--Google API-->
		<script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?key=AIzaSyDDZ2cfkjgRuqcVocQt_xt4esmqpNQT3KM&sensor=false"></script>
		<script type="text/javascript">
			$(document).ready(function() {

				$(".errorVisual").hide();
				$("#labelSensorSelect").hide();
				//$("#container").hide();
				$("#containerTools").hide();
				if(!$("#selectLibrary").value=="highcharts" && $("#motionType").is(":checked"))

				$("#divWindowSize").hide();
				
				//$("#container").hide();
				//Setting up in async mode
				jQuery.ajaxSetup({
					async : false
				});
				/*
				* Global variables and settings
				*/

				//Setting the charting library to use local time
				Highcharts.setOptions({
					global : {
						useUTC : false
					}
				});

				var container = $('#container')[0];
							$('#resizer').resizable({
				    // On resize, set the chart size to that of the
				    // resizer minus padding. If your chart has a lot of data or other
				    // content, the redrawing might be slow. In that case, we recommend
				    // that you use the 'stop' event instead of 'resize'.
				    resize: function() {
				        chart.setSize(
				            this.offsetWidth - 20,
				            this.offsetHeight - 20,
				            false
				        );
				    }
				});

				var chart;

				function createChart()
				{
				chart = new Highcharts.Chart({
					chart : {
						renderTo : 'container',
						type : 'line',
						marginRight : 130,
						marginBottom : 25,
						useUTC : false,
						zoomType : 'xy',

						events: {
					        	selection: function(event){

					        		//$("#motionStop").click();
					        				}
					        	}		
					},
					title : {
						text : 'Motion Graph',
						x : -20 //center
					},
					subtitle : {
						text : '',
						x : -20
					},
					xAxis : {
						type : 'datetime',

					},
					plotOptions : {
						line : {
							marker : {
								enabled : false
							}
							
						}
						
					},
					yAxis : {
						title : {
							text : 'Readings'
						},
						plotLines : [{
							value : 0,
							width : 1,
							color : '#808080',
							line : {
								marker : {
									enabled : true
								}
							}
						}]
					},
					tooltip : {
						formatter : function() {
							return '<b>' + this.series.name + '</b><br/>' + Highcharts.dateFormat('%e%b', this.x) + ': ' + this.y;
						}
					},
					credits : {
						enabled : false
					},
					legend : {
						layout : 'vertical',
						align : 'right',
						verticalAlign : 'top',
						x : 0,
						y : 100,
						borderWidth : 0
					},
					series : series
				});
	

			}
	


				$("#logout").attr('href', URL_LOGOUT_USER);
				$("#home").attr('href', URL_HOME);
				$("#errorDiv").hide();

				$("#devices").attr('href', URL_DEVICES);
				$("#visualization").attr('href', URL_VISUALIZATION);
				//$("#logout").attr('href', URL_LOGOUT_USER);
				$("#repositoryInformation").attr('href', URL_REPOSITORY_INFO);
				$("#logout").click(function() {

					window.location = URL_LOGOUT_USER;
				});
				function alertError(errorMessage) {
					$("#errorDiv").html(errorMessage);
					$("#errorDiv").fadeIn('slow');
					return false;
				}

				function removeError() {
					$("#errorDiv").html("");
					$("#errorDiv").hide();
					return false;
				}

				//series=appendElementsToSeries(series,SAMPLE_QUERY_DATA_QUERY_RESPONSE);

				//Setting the correct datetime format to start and end time dialog
				$(ID_START_DATE_TIME_DISPLAY).datetimepicker({
					changeMonth : true,
					changeYear : true,
					dateFormat : "yy-mm-dd",
					separator : "-"
				});

				$(ID_END_DATE_TIME_DISPLAY).datetimepicker({
					changeMonth : true,
					changeYear : true,
					dateFormat : "yy-mm-dd",
					separator : "-"
				});

				var startTime;
				var endTime;
				var receivedData;
				var errorState;
				var errorInformation;
				var query;
				var username = $("#username").val();
				var secretkey = FAKE_SECRET_KEY;
				var series = new Array();
				var receivedDeviceData = {};
				var motionCounter;
				var motionInterval;
				var motionStatus=true;
				var SPEED=1;
				var minTimeStamp=-1;
				var maxTimeStamp=-1;
				var WINDOW_SIZE=$("#windowSize").val();
				var motionType=$("#motionType").is(':checked');
				var library=$("#selectLibrary").val();
				var map;
				var line;
				var newPath=new Array();
				var tempPath=new Array();
				var motionMarker;
				var overlays=[];
				var downloadData=new Array();
				var statsData="";

				$("#motionStop").click(function() {

							
							//clearInterval(motionInterval);
							if(motionStatus)		
							{
								motionStatus=false;
								$(this).html("Start");
								$(this).removeClass("pause");
								$(this).addClass("play");								
								clearTimeout(motionInterval);


										if((library=="highcharts" && motionCounter==(maxTimeStamp-(WINDOW_SIZE-2)*oneSECOND))|| (library=="google" && motionCounter==newPath.length))
										{	
											line.setMap(null);
											
											motionStatus=true;
											$(this).html("Stop");
											$(this).removeClass("play");
											$(this).addClass("pause");
											$("#IDSendQuery").click();
										}
							}
							else
							{
								
								motionStatus=true;
								$(this).html("Stop");
								$(this).removeClass("play");
								$(this).addClass("pause");
								if(library=="highcharts")
									motionRepeat();
								else if(library=="google")
									mapRepeat();

							}


				});

				$("#speed").change(function(){

					SPEED=(this).value;
					
				});

				$("#motionType").change(function(){

					motionType=$(this).is(':checked');
					if(!$(this).is(':checked'))
						{

							$("#speed").attr('disabled','disabled');
							$("#containerTools").hide();		
							$("#divWindowSize").hide();
						}
					else
					{	
							$("#speed").removeAttr('disabled');
							//$("#containerTools").show();
							
							if($("#selectLibrary").val()=="highcharts")
								$("#divWindowSize").show();
					}
					

				});

				$("#selectLibrary").change(function(){
					library=(this).value;

					
					if(this.value=="highcharts" && $("#motionType").is(":checked"))
						$("#divWindowSize").show();
					else
						$("#divWindowSize").hide();

				});
				$("#windowSize").change(function(){
					
						WINDOW_SIZE=(this).value;

				});
				function calcTimeStamp()
				{
						//Minimum TimeStamp
						if(minTimeStamp==-1)
							minTimeStamp=chart.series[0].data[0].x;

						for(i=0;i<chart.series.length;i++){

						if(chart.series[i].data[0].x<minTimeStamp)
							minTimeStamp=chart.series[i].data[0].x;
						}

						//Maximum TimeStamp
						if(maxTimeStamp==-1)
							maxTimeStamp=chart.series[0].data[chart.series[0].data.length-1].x;
						for(i=0;i<chart.series.length;i++){

							if(chart.series[i].data[chart.series[i].data.length-1].x>maxTimeStamp)
								maxTimeStamp=chart.series[i].data[chart.series[i].data.length-1].x;
						}
				}

				/*
				 * Description:This function takes the device name,selected set of sensors and start
				 * and end time and for each sensor makes a request to the Server to fetch the data
				 * It also calls the function appendElementToSeries which for each Sensor adds it to
				 * the charting library
				 *
				 * I/P:
				 * 1.Name of device
				 * 2.Array Of Selected Sensors
				 * 3.Start Time					//$.get("http://www.google.com" + "?secretkey=" + secretkey, function(data){

				 * 4.End Time
				 *
				 * O/P:
				 * 1.AJAX POST to UI Server+Adding the new series to the chart
				 */

				//function makeRequestAndDisplayChart(selectedDeviceName, selectedSensorArray, startTime, endTime) {
				function makeRequestAndDisplayChart(allSelectedItems,startTime,endTime) {
					//for(device in allSelectedItems
				statsData="";
					for(device in allSelectedItems){
						//
						for(sensor in allSelectedItems[device]) {
							
							var query = {};
							query[QUERY_CONDITIONS] = {};
							query[QUERY_CONDITIONS][QUERY_CONDITIONS_FROM_TIME] = startTime;
							query[QUERY_CONDITIONS][QUERY_CONDITIONS_TO_TIME] = endTime;
							query[QUERY_DEVICE_NAME] = device;
							query[QUERY_SENSOR_NAME] = allSelectedItems[device][sensor];
							query[QUERY_USER_NAME] = username;
							//

							//receivedData = SAMPLE_QUERY_DATA_QUERY_RESPONSE;
							try {

								$.post(URL_QUERY_DATA, JSON.stringify(query), function(data) {
									receivedData = data;
									//
									downloadData.push(receivedData);
									//

								});
								if(!(receivedData.hasOwnProperty(RESPONSE_STATUS_CODE)))
								//Means it contains data
								{	

									$("#box").show();
									$("#container").show();
									
									series = appendElementsToSeries(series, receivedData);

								} else {

									var r = showNoty("Error occured in fetching data/Data does not exist for " + selectedSensorArray[i], "center", "off");
								}

							} catch(e) {
								
							}
						}
					}	
					var textDownload='data:text/html;charset=utf-8,%3C%21DOCTYPE%20' +
									  'html%3E%0D%0A%3Chtml%20lang%3D%22en%22%3E%0D%0A%3Chead%' +
									  '3E%3Ctitle%3EEmbedded%20Window%3C%2Ftitle%3E%3C%2Fhead%' +
									  '3E%0D%0A%3Cbody%3E%3Ch5%3E'+JSON.stringify(downloadData)+'%3C%2Fh5%3E%3C%2Fbody%3E%0A' +
									  '%3C%2Fhtml%3E%0A%0D%0A';
					$("#downloadData").show();
						$("#dialog").html(statsData);
					
					//$("#downloadDataAnchorTag").attr("onclick","
					$("#downloadDataAnchorTag").attr("onclick","window.open('"+textDownload+"','_blank','height=300,width=400');return false;");
						clearTimeout(motionInterval);
						
						if(motionType)
						{
							SPEED=$("#speed").val();
							if(library=="highcharts")
							{	calcTimeStamp();
								motionCounter=minTimeStamp;
								motionRepeat();
							}
							else if(library=="google")
							{
								motionCounter=0;
								mapRepeat();
							}
							
						}
						else
						{

						}

					}

					$( "#dialog:ui-dialog" ).dialog( "destroy" );
					var dlg = $("#dialog").dialog({
  						autoOpen: false,
  						draggable: true,
  						resizable: false,
 						 width: 500,
 						 modal:true
					});	

				$("#buttonStats").click(function() {
					  dlg.dialog("open");
					
					    dlg.dialog("option", "position", {
					    //my: "center top",
					    //at: "right top",
					    //offset: "20 20"
					  });
					return false;
					});//.mouseout(function() {
					  //dlg.dialog("close");
					//});
				/*
				 * Validate the parameters to query for visualization
				 * I/p:
				 * Device name,SelectedSensors,startTime,endTime
				 * O/p:
				 * An array of 2 objects:
				 * 1.The error state:true/false
				 * 2.Error Information associated
				 */

				function validateVisualizationQuery(allSelectedItems, startTime, endTime) {
					
					$(".errorVisual").hide("");
					$("#IDDeviceSelect,#start_date_time,#end_date_time").removeClass("error");
					errorState = false;
					errorInformation = "";
					var sensorError=false;
					for(device in allSelectedItems){
						if(allSelectedItems[device].length==0)
						{	
							sensorError=true;
							$("#span"+removeSpace(device)).show('slow',function(){});
							$("#span"+removeSpace(device)).html('Please Select Sensor');
						}
						
						}

					
			
					
					if(deviceName.length==0) {
						errorState = true;
						//errorInformation += "Select a device ";
						$("#IDDeviceSelect").addClass("error");
						$("#spanDevice").show('slow', function() {
						});

						$("#spanDevice").html("Please Select a device");
						$("#IDDeviceSelect").focus();
					} else if(sensorError) {
						errorState = true;
						//errorInformation += "Select a sensor";
						//$("#spanSensor").show('slow', function() {
						//});
						//$("#spanSensor").html("Please Select a Sensor");

					} else if(startTime.length == 0) {
						errorState = true;
						//errorInformation += " Please provide a valid start time";
						$("#start_date_time").addClass("error");
						$("#spanStartTime").show('slow', function() {
						});
						$("#spanStartTime").html("Please select Start Time");

					} else if(endTime.length == 0) {
						errorState = true;
						//errorInformation += " Please provide a valid end time";
						$("#end_date_time").addClass("error");
						$("#spanEndTime").show('slow', function() {
						});
						$("#spanEndTime").html("Please select End Time");
						//$("#end_date_time").focus();
					} else if(startTime >= endTime) {
						errorState = true;
						//errorInformation += " Start Time should be less than end time";
						$("#spanEndTime").show('slow', function() {
						});
						$("#spanEndTime").html("Start Time should be less than end time");

					}

					return [errorState, errorInformation];
				}

				/*
				 * Method to send the query
				 * I/P
				 * 1.Device Name
				 * 2.Sensors under the device
				 * 3.Start time and end time
				 *
				 * Validations
				 * This method does validation on the all the specified fields
				 * 1.Device must be selected(By default a None option is provided)
				 * 2.Atleast one sensor must be selected
				 * 3.Starttime should be less than the end time
				 *
				 * O/P
				 * For each sensor in the selected list of sensors this function call would
				 * make a call to the repository and fetch the daQUERY_CONDITIONSom it and append it to
				 * the "series" variable which is passed as an argument to the charting library
				 * If any of the validity tests fail then the corresponding information is alerted
				 * to the user.In case all the validations pass a per sensor query of the format
				 * defined in Constants.js is sent to the server component of the UI
				 */
				$("#IDSendQuery").click(function() {
					motionStatus=true;
					$("#motionStop").removeClass("play");
					$("#motionStop").addClass("pause");
				

					if(library=="highcharts")
					{	
					
						createChart();
						//Empty the previous entries
						while(chart.series.length > 0) {	

						chart.series[0].remove();
						}//CLearing data from previous calls
					
					}
					else if(library=="google")
					{
						
						
							// if (overlays) {
						 //    for (i in overlays) {
						      
						 //      
						 //    }
						 //    overlays.length = 0;
						//}

					}
					var query = {};

					var allSelectedItems={};
					var selectedSensorArray = new Array();

					var selectedSensorArrayLength = 0;

					var selectedDeviceName = deviceName;

				for(var i=0;i<selectedDeviceName.length;i++){
						allSelectedItems[selectedDeviceName[i]]=[];
					$("#div"+removeSpace(selectedDeviceName[i])).children('.sensor').find("input").each(function() {
						//selectedSensorArrayLength = selectedSensorArray.length;
						if($(this).prop("checked")) {
							//selectedSensorArray[selectedSensorArrayLength] = $(this).val();
							//selectedSensorArrayLength++;
							
							allSelectedItems[selectedDeviceName[i]].push(($(this).val()));

						}
						
							

					});
				}
				
					if($(ID_START_DATE_TIME_DISPLAY).val().length > 0) {
						startTime = datetimeToEpoch($(ID_START_DATE_TIME_DISPLAY).val());
					} else {
						startTime = $(ID_START_DATE_TIME_DISPLAY).val();
					}
					if($(ID_END_DATE_TIME_DISPLAY).val().length > 0) {
						endTime = datetimeToEpoch($(ID_END_DATE_TIME_DISPLAY).val());
					} else {
						endTime = $(ID_END_DATE_TIME_DISPLAY).val();
					}
					
					var errorStatus =validateVisualizationQuery(allSelectedItems, startTime, endTime);
					if(errorStatus[0]) {
						
						return false;
					} else {
						removeError();
					}
					//
					//Now for each sensor in the selectedSensorList we would make a query and fetch the data and draw chart
					//makeRequestAndDisplayChart(selectedDeviceName, selectedSensorArray, startTime, endTime);
					
					makeRequestAndDisplayChart(allSelectedItems,startTime,endTime);

				});

			//Getting Device List
				try {
					$.get(URL_LIST_ALL_DEVICES, function(data) {
						//
						receivedDeviceData = data;
						//

					});
				} catch(e) {
					
				}
				//Make a get request to get all the devices available
				if(!(receivedDeviceData.hasOwnProperty(RESPONSE_STATUS_CODE)))//Success
				{

					if(receivedDeviceData[DEVICE_ARRAY].length > 0) {

						for(var index in receivedDeviceData[DEVICE_ARRAY]) {
							var name = receivedDeviceData[DEVICE_ARRAY][index][DEVICE_NAME];

							$("#divDeviceSelect").append("<div class=\"device\" id=\"div"+removeSpace(name)+"\"><input type=\"checkbox\" name=\"IDDeviceSelect\" value=\"" + name + "\" />" + name + "</div>");
						}

						/*
						 * Description:This function is used to change the HTML contents corresponding to a selected device
						 * It basically adds relevant HTMl in accordance with the device selected
						 *
						 * Nature:Anonmyous function
						 *
						 * Called:Called every time a change occurs in the dropdown menu
						 *
						 */


						 var deviceName = new Array();
				$("input[name=IDDeviceSelect]").click(function() {
							
							$("#spanDevice").hide();
							$("#labelSensorSelect").hide();
							$(".errorVisual").hide();
							
						if($(this).is(":checked")){

							deviceName.push(this.value);
							
				
							//
							 for(var index in receivedDeviceData[DEVICE_ARRAY]) {
								var name = receivedDeviceData[DEVICE_ARRAY][index][DEVICE_NAME];
								//if(deviceName.indexOf(name)!=-1) {
								if(name==this.value){	
							 		if($("#IDDeviceSelect").is('.error')) {
							// 			//
							 			$("#IDDeviceSelect").removeClass("error");
										$("#spanDevice").hide();
							 			$("#IDSendQuery").removeAttr("disabled", "disabled");

							 		}

							 		if( DEVICE_SENSORS in receivedDeviceData[DEVICE_ARRAY][index]) {
							 			removeError();
							 			var sensorArray = receivedDeviceData[DEVICE_ARRAY][index][DEVICE_SENSORS];
							 			$("#labelSensorSelect").show();

							 			$("#div"+removeSpace(name)).append("<div class=\"sensor\">");
							 			for(var sensor in sensorArray) {
							 				$("#div"+removeSpace(name)).children(".sensor").append("<input id=\"sensorID\" type=\"checkbox\"value=" + sensorArray[sensor][DEVICE_SENSOR_NAME] + ">" + sensorArray[sensor][DEVICE_SENSOR_NAME] + "&nbsp&nbsp</input>");
							 			}
							 			$("#div"+removeSpace(name)).append("</div><span class=\"errorVisual\" id=\"span"+removeSpace(name)+"\" style=\"display:none;\"></span>");
							 			
							 			error=0;
							 		} 
							 		//else {
							// 			//
							// 			$("#IDDeviceSelect").addClass("error");
							// 			$("#spanDevice").show('slow', function() {
							// 			});
							// 			$("#IDSendQuery").attr("disabled", "disabled");
							// 			$("#spanDevice").html("Please select a device which contains sensors!!");
							// 			$("#IDDeviceSelect").focus();
							// 		}
							 	}
							}
						}
						else
							{
								$("#div"+removeSpace(this.value)).children('.sensor').remove();
								deviceName.splice(deviceName.indexOf(this.value),1);
							}
							//return false;
						});
					} else {
						
					}
				} else {
					
				}

				/*
				 * Description:This function$(#IDSensorsSelect").append("<span class='errorVisual' id='spanSensor'></span>"); is used to append series to the chart
				 *
				 * I/P:Response to the query to view data which is of the form of
				 * SAMPLE_QUERY_DATA_QUERY_RESPONSE in constants.js
				 *
				 *
				 */
				function appendElementsToSeries(series, receivedData) {
					//
					$("container").show();
					$("#containerTools").show();
					var numberOfSeries = receivedData["chartSeries"].length;
					var numberofData=receivedData["chartSeries"][0]["data"].length;

					//Adding Stats//
					for(var i=0;i<numberOfSeries;i++){
					
						statsData+="<br /><u><b>"+ receivedData["chartSeriesStats"][i]["name"]+ "</b></u>&nbsp&nbsp Min:" + receivedData["chartSeriesStats"][i]["min"].toFixed(2) + "&nbsp&nbspMax:"+receivedData["chartSeriesStats"][i]["max"].toFixed(2)+ "&nbsp&nbspAvg:"+receivedData["chartSeriesStats"][i]["avg"].toFixed(2);
					}
					//Statistic Data Added//

					if(library=="highcharts")
					{
						
						for(var i = 0; i < numberOfSeries; i++) {
						chart.addSeries(receivedData["chartSeries"][i]);
						}
					}
					else if(library=="google")
					{
						
						var myLatlng=new Array();
						newPath=new Array();
						
						//Initial Point
						
						var m=receivedData["chartSeries"][0]["data"][0][1];
						var n=receivedData["chartSeries"][1]["data"][0][1];
						var myLatlng = new google.maps.LatLng(m,n);
						
						
       					 var myOptions = {
        				  center: myLatlng,
        				  zoom: 14,
         				  mapTypeId: google.maps.MapTypeId.ROADMAP
        				 };
        				 
       					 map = new google.maps.Map(document.getElementById("container"),myOptions); 
        				
        				var marker = new google.maps.Marker({
    					position: myLatlng,
    					map: map,
    					title: 'Initial Position'
  						});
        				overlays.push(marker);
						//
						for(var j=0;j<numberofData;j++)
						{
							var timestamp=receivedData["chartSeries"][0]["data"][j][0];
							var latlng=new Array();					
							for(var i = 0; i < numberOfSeries; i++) {
								
								latlng[i]=receivedData["chartSeries"][i]["data"][j][1];
								
							}
											
							 
							newPath[j]=new google.maps.LatLng(latlng[0],latlng[1]);
						}
						
						

						if(!motionType)
						{
						line = new google.maps.Polyline({
	         			 path: newPath,
	         			 strokeColor: '#ff0000',
	          			 strokeOpacity: 1.0,
	          			 strokeWeight: 3
	        				});
	        			 line.setMap(map);
	        			 overlays.push(line);
						 //
	       				 //var line = new google.maps.Polyline({
	         			// path: newPath,
	         			// strokeColor: '#ff0000',
	          			// strokeOpacity: 1.0,
	          			 //strokeWeight: 3
	        			//	});
	        			// line.setMap(map);
	        			// overlays.push(line);

	        			 //Mid Marker
	        			 var midMarker = new google.maps.Marker({
    					 position: newPath[Math.round((numberofData-1)/2)],
    					 map: map,
    					 title: 'Mid Point'
  						 });
  						 overlays.push(midMarker);

  						 //End Point Marker
	        			 var endMarker = new google.maps.Marker({
    					 position: newPath[numberofData-1],
    					 map: map,
    					 title: 'Final Position'
  						 });
	        			 overlays.push(endMarker);
  						}
  						else
  						{
  						line = new google.maps.Polyline({
	         			 path: tempPath,
	         			 strokeColor: '#ff0000',
	          			 strokeOpacity: 1.0,
	          			 strokeWeight: 3
	        				});
	        			 line.setMap(map);
	        			 overlays.push(line);
  							motionMarker=new google.maps.Marker({
  								position:newPath[0],
  								map:map,
  								title:'End Position'

  							});
  							overlays.push(motionMarker);
  						}
  						
						
					}
					

					return series;
				}

				
				function motionRepeat(){

					if(motionStatus)
					{
						if(motionCounter<maxTimeStamp-(WINDOW_SIZE-2)*1000)		 
						{	 
							chart.xAxis[0].setExtremes(motionCounter,motionCounter+WINDOW_SIZE*oneSECOND);
        					 motionCounter+=1000;
        					 motionInterval=setTimeout(motionRepeat,oneSECOND/SPEED);
        					
        				}
        				else
        				{
							//$("#motionStop").html("RESTART");
							$("#motionStop").removeClass("pause");
							$("#motionStop").addClass("play");
						}
					}
				}


				function mapRepeat()
				{	
					
				
				
				//  	
					
					if(motionStatus)
					{
						
						if(motionCounter<newPath.length)
						{						
	       				
						//tempPath.push(newPath[motionCounter]);
						
					

	        			 //overlays.push(line);
	        			 poly=line.getPath();
	        			 poly.push(newPath[motionCounter]);
	        			 //
	        			 motionMarker.setPosition(newPath[motionCounter]);

	        			 motionCounter++;
	        			 setTimeout(mapRepeat,oneSECOND/SPEED);
	        			 //Mid Marker
	        			 //var midMarker = new google.maps.Marker({
    					 //position: newPath[Math.round((newPath.length-1)/2)],
    					 //map: map,
    					 //title: 'Mid Point'
  						 //});

	        			 //End Point Marker
	        			 
						}
						else{
							$("#motionStop").removeClass("pause");
							$("#motionStop").addClass("play");
						}
					}
				}

			});

		</script>
	</head>
	<body>
		
	<div id="header-container">
		<header class="wrapper clearfix">
			<h1 id="title">SensorAct<br /><br /><span style="font-size:25px;">Sense - Interact - Actuate</span></h1>
			
			
			<!--<nav>	
	
			
				<ul>
					<li>
						<a id="home" >Home</a>
					</li>
					
					<li>
						<a id="logout">Logout</a>
					</li>
				</ul>
						
			</nav>-->
			
			<nav>
			<ul>
				<li>
					<a id="devices" >Devices</a>
				</li>
				<li>
					<a id="visualization" class="active">Visualization</a>
				</li>
				<li>
					<a id="repositoryInformation">Repository Info</a>
				</li>
				<!--<li>
						<a id="logout">Logout</a>
				</li>-->
				
			</ul>
		</nav>
		<br />
		<br />
		<nav>
					<p class="pbox" style="margin-bottom:-20px;">
						Welcome ${username} &nbsp | &nbsp<span id="logout">Logout</span>
					</p>
		</nav>
	
	
		</header>
	</div>
		<div class="wrapper">
		<div id="errorDiv" class="errorDiv"></div>
		
		<div>
			<h1 class="newfont" style="text-align:center;">Visualization</h1>
			<hr>
		</div>
			<div id="visualBox" style="">
				<div class="leftDiv">
					<label>Select Devices</label>
				</div>
				<div class="rightDiv">
					<div id="divDeviceSelect">
						
					</div>
				<span class="errorVisual" id="spanDevice"></span>
				</div>			
				<!--<div id="labelSensorSelect" class="leftDiv"><label>Select Sensor</label></div>
				
				<div id="IDSensorsSelect" class="rightDiv" style=""></div>
				-->
				<div class="leftDiv">
				<label>Start Date :</label>
				</div>
				<div class="rightDiv">
				<input type="text" id="start_date_time" name="start_date_time" readonly='true' /><span class="errorVisual" id="spanStartTime"></span>
				</div>
				<div class="leftDiv">
				<label>End Date Time :</label>
				</div>
				<div class="rightDiv">
				<input type="text" id ="end_date_time" readonly='true' name="end_date_time" /><span class="errorVisual" id="spanEndTime"></span>
				</div>
				<div class="leftDiv">
				<label>Speed:</label>
				</div>
				<div class="rightDiv">
				<select id="speed">
					<option value="1">1X</option>
					<option value="2">2X</option>
					<option value="0.5">0.5X</option>
					<option value="0.25">0.25X</option>
					<option value="10">10X</option>
					<option value="30">30X</option>
				</select>
				</div>
				<br />
				
			</div>
			<div id="visualFunctions" style="float:right;">
				<div class="leftDiv">
					Choose a Library
				</div>
				<div class="rightDiv">
					<select id="selectLibrary">
						<option value="highcharts">HighCharts</option>
					<option value="google">Google</option>
					</select>
					
				</div>
				<br />
				<div class="leftDiv">
					<label>Motion Display</label>
				</div>
				<div class="rightDiv">
					<input type="checkbox" name="motionType" id="motionType" checked="true" />
				</div>
				<div id="divWindowSize">
				<div class="leftDiv">
					<label>Choose Window Size</label>
				</div>
				<div class="rightDiv">
					<select id="windowSize">
						<option value="10">10</option>
						<option value="20">20</option>
					</select>
				</div>
				</div>
			</div>
			
		
		<div style="clear:both;text-align:center;">
		<button class="google-button" id="IDSendQuery" >
				View Data
				</button>
				<hr>
			
				
		</div>
			
			<div id="resizer">
			    <div id="inner-resizer">
			        <div id="container" style="height: 400px;clear:both;">
			        </div>
			    </div>
			</div>
			<div id="containerTools" style="text-align:center;"><button id="motionStop" class="pause">Stop</button></div>
<center>			
<div id="dialog" style="font-family:arial,font-size:-1;color:orange;"></div>
<div id="downloadData" style="display:none;"><button class="google-button-blue" id="downloadDataAnchorTag">Download Data</button>&nbsp&nbsp<button class="google-button-red" id="buttonStats">Statistics</button></div>
</center>
		
		</input>
		<input type="hidden" id =username value =${username}>
		</input>

	</div>


	<hr>	
	</div>
	
	<div style="clear:both;" id="footer-container">
		<footer class="wrapper">
			<h4 align="center">&copy2012 |MUC,IIIT-Delhi</h4>
		</footer>
	</div>

</body>
	
</html>