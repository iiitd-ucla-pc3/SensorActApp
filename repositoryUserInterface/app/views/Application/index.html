<!doctype html> <!--[if lt IE 7]> <html class="no-js ie6 oldie" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js ie7 oldie" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js ie8 oldie" lang="en"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en">
	<!--<![endif]-->
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<title> SensorAct </title>
		<link rel="stylesheet" type="text/css" href="@{'/public/stylesheets/style.css'}">
		<script src="@{'/public/js/libs/modernizr-2.0.6.min.js'}"></script>
		<script src="@{'/public/javascripts/jquery-1.6.4.min.js'}" type="text/javascript" charset="${_response_encoding}"></script>
		<script src="@{'/public/javascripts/constants.js'}" type="text/javascript" charset="${_response_encoding}"></script>
		<script type="text/javascript">
			$(document).ready(function() {

				var sign_in_username;
				var sign_in_password;
				var sign_in_validation_state = false;
				var sign_up_username;
				var sign_up_password;
				var sign_up_confirmation;
				var sign_up_email;
				var sign_up_validation_state = false;
				var responseFromServer = {};
				var emailReg = /^([\w-\.]+@([\w-]+\.)+[\w-]{2,4})?$/;
				//Setting up in async mode
				jQuery.ajaxSetup({
					async : false
				});
				//Hide all forms
				//$(".forms").hide();
				$("#errorDiv").hide();

				function alertError(spanid, errorMessage) {

					$("#" + spanid).html(errorMessage);

					return false;
				}

				function removeError() {
					$("#errorDiv").html("");
					$("#errorDiv").hide();
					return false;
				}

				function validateSignUp(username, password, confirm_password, email) {
					var flag = true;
					if(username.length < MIN_LENGTH_USERNAME) {
						$("#span_sign_up_username").text("Must be atleast " + MIN_LENGTH_USERNAME + " characters");
						$("#sign_up_username").addClass("error");
						flag = false;
					} else if(username.length > MAX_LENGTH_USERNAME) {
						$("#span_sign_up_username").text("Must be atmost " + MAX_LENGTH_USERNAME + " characters");
						$("#sign_up_username").addClass("error");
						flag = false;
					} else {
						$("#span_sign_up_username").text("");
						var receivedData;

						$("#sign_up_username").removeClass("error")
					}
					if(password.length < MIN_LENGTH_PASSWORD) {
						$("#span_sign_up_password").text("Must be atleast " + MIN_LENGTH_PASSWORD + " characters");
						$("#sign_up_password").addClass("error");
						flag = false;
					} else if(password.length > MAX_LENGTH_PASSWORD) {
						$("#span_sign_up_password").text("Must be atmost " + MAX_LENGTH_PASSWORD + " characters");
						$("#sign_up_password").addClass("error");
						flag = false;
					} else {
						$("#span_sign_up_password").text("");
						$("#sign_up_password").removeClass("error")
					}
					if(confirm_password != password) {
						$("#span_sign_up_confirmation").text("Must be same as password");
						$("#sign_up_confirmation").addClass("error");
						flag = false;
					} else {
						$("#span_sign_up_confirmation").text("");
						$("#sign_up_confirmation").removeClass("error")
					}
					if((!emailReg.test(email)) || (email.length == 0)) {
						$("#span_sign_up_email").text("Invalid Email Id");
						$("#sign_up_email").addClass("error");
						flag = false;

					} else {
						$("#span_sign_up_email").text("");
						$("#sign_up_email").removeClass("error")
					}

					return flag;
				}


				$("#sign_up_confirmation").keyup(function() {
					if($(this).val() != $("#sign_up_password").val()) {
						$('#span_sign_up_confirmation').text("Passwords don't match.");
					} else {
						$('#span_sign_up_confirmation').text("");
					}
				});

				$("#sign_in_username").keypress(function(e) {
					if(e.keyCode == 13) {

						$('#sign_in_submit').click();
					}
				});

				$('#sign_in_password').keypress(function(e) {
					if(e.keyCode == 13) {

						$('#sign_in_submit').click();
					}

				});

				$("#sign_in_submit").click(function() {
					sign_in_username = $("#sign_in_username").val();
					sign_in_password = $("#sign_in_password").val();
					//sign_in_validation_state = validateSignIn(sign_in_username, sign_in_password);
					//if(sign_in_validation_state) {
					var sign_in = {};
					sign_in[USERNAME] = sign_in_username;
					sign_in[PASSWORD] = sign_in_password;
					//Submit the login details
					try {
						$.post(URL_LOGIN_USER, JSON.stringify(sign_in), function(data) {
							responseFromServer = data;

						});
						if((responseFromServer[RESPONSE_STATUS_CODE]) == 0) {
							window.location = URL_HOME;

						} else {
							alertError('sign_in_error', responseFromServer[RESPONSE_MESSAGE]);
						}

					} catch(e) {
						alertError('sign_in_error', e);
					}
					//}

				});
				$("#sign_up_submit").click(function() {
					sign_up_username = $("#sign_up_username").val();
					sign_up_password = $("#sign_up_password").val();
					sign_up_confirmation = $("#sign_up_confirmation").val();
					sign_up_email = $("#sign_up_email").val();
					sign_up_validation_state = validateSignUp(sign_up_username, sign_up_password, sign_up_confirmation, sign_up_email);
					if(sign_up_validation_state) {
						var sign_up = {};
						sign_up[USERNAME] = sign_up_username;
						sign_up[PASSWORD] = sign_up_password;
						sign_up[EMAIL] = sign_up_email;
						//alert(JSON.stringify(sign_up));
						//Submit the login details
						try {

							$.post(URL_REGISTER_USER, JSON.stringify(sign_up), function(data) {
								responseFromServer = data;

							});
							if((responseFromServer[RESPONSE_STATUS_CODE] != 0)) {
								alertError("Following error occured " + responseFromServer[RESPONSE_MESSAGE])

							} else {
								removeError();
								window.location = URL_HOME;

							}

						} catch(e) {
							alertError(e);
						}
					}

				});
			});

		</script>
	</head>
	<body>
		<div id="header-container">
			<header class="wrapper clearfix">
				<h1 id="title">SensorAct
				<br />
				<br />
				<span style="font-size:25px;">Sense - Interact - Actuate</span></h1>
				<nav>
					<p class="pbox">
						<label for="sign_in_username">Username</label>
						<input type="text" size="10" name="sign_in_username" id="sign_in_username" />
						<br />
						<br />
						<label for="sign_in_password">Password</label>
						<input type="password" size="10" name="sign_in_password" id="sign_in_password" />
						<br />
						<br />
						<span id="sign_in_error"></span>
					</p>
					<ul>
						<li>
							<a style="float:right;" name="sign_in_submit" href="#" id="sign_in_submit">Sign In</a>
						</li>
					</ul>
				</nav>
			</header>
		</div>
		<div id="main-container">
			<div id="main" class="wrapper clearfix">
				<article>
					<header>
						<h1 class="newfont">Introducing SensorAct Project</h1>
						<hr>
						<iframe width="420" height="315" src="http://www.youtube.com/embed/cFAV5jNvQwg" frameborder="0" allowfullscreen></iframe>
					</header>
				</article>
				<br />
				<aside>
					<h2 class="newfont"><b>Register</b></h2>
					<label for="sign_up_username">Username</label>
					<input type="text" name="sign_up_username" size="15" id="sign_up_username" />
					<label></label>
					<span id="span_sign_up_username"></span>
					<br />
					<label for="sign_up_password">Password</label>
					<input type="password" name="sign_up_password" size="15" id="sign_up_password" />
					<label></label>
					<span id="span_sign_up_password"></span>
					<br />
					<label for="sign_up_confirmation">Password</label>
					<input type="password" name="sign_up_confirmation" size="15" id="sign_up_confirmation" />
					<label></label>
					<span id="span_sign_up_confirmation"></span>
					<br />
					<label for="sign_up_email">Email ID</label>
					<input type="email" name="sign_up_email" size="15" id="sign_up_email" />
					<label></label>
					<span id="span_sign_up_email"></span>
					<br />
					<nav>
						<p class="pbox">
							<label name="sign_up_submit" id ="sign_up_submit" class="buttons"> Sign Up </label>
						</p>
					</nav>
				</aside>
				<article
				<footer>
				<p>Smart Rooms</p>
				<p>A Novel approach to integrate the physical and the cyber world.</p>
				<p>Sensors And Actuators</p>

				</footer>
				</article>
				</div> <!-- #main -->
				</div> <!-- #main-container -->

				<div style="clear:both;" id="footer-container">
				<footer class="wrapper">
				<h4 align="center">&copy2012 |MUC,IIIT-Delhi</h4>
				</footer>
				</div>

				</body>

				</html>
